# 第二章 应用层
## 2.1 应用层协议原理
- **2.1.1 网络应用程序体系结构：** 由程序研发者设计，规定了如何在各种端系统上组织应用程序。
  - **客户-服务器体系结构：** 有一个总是打开的主机，称为服务器，以及一个或多个客户端，这些客户端通过服务器的IP地址发送请求，服务器响应请求。客户之间不能直接通信。
  - **P2P体系结构：** 对等连接，没有固定的客户端和服务器。应用程序在间断连接的主机对之间直接通信。
- **2.1.2 进程通信：** 在两个不同端系统上的进程，通过跨越计算机网络交换报文而通信。在同一个端系统上的多个进程通过操作系统的进程通信机制相互通信。
  - **客户端和服务器进程：** 在每对通信通信进程中，通常将发起通信的进程标识为客户，在会话开始等待联系的进程标识为服务器
  - **进程与计算机网络之间的接口：** 进程通过套接字接口向网络发送报文，套接字是同一台主机内应用层与运输层之间的接口。
  - **进程寻址：** 为了标识一个进程，需要两个信息：主机的IP地址和应用的端口号。
- **2.1.3 可供应用程序使用的运输服务**
  - **可靠的数据传输：** 一个协议提供了可靠的数据传输服务，需确保应用程序的一端发送的数据正确，完全的交付给应用程序的另一端。
  - **吞吐量：** 带宽敏感的应用具有特定的吞吐量要求，需要运输协议能够确保可用吞吐量总是至少为r比特/秒。
  - **定时：** 运输层协议能够提供定时保证，如发送方注入进套接字的每个比特到达接收方的套接字不迟于100ms。
  - **安全性：** 运输协议能够加密由发送进程传输的数据，在接收主机中，运输层协议能够在将数据交付给接收进程前解密数据。
- **2.1.4 因特网提供的运输服务：** 因特网为应用程序提供了两个运输层协议，即UDP和TCP
  - **TCP服务：** 提供了面向连接的服务，可靠数据传输、流量控制、拥塞控制、全双工数据传输，未提供加密机制等。
    - **SSL：** 安全套接字层，是一种应用层的实现，用SSL加强后的TCP能够做传统TCP的一切，并为TCP提供了加密、数据完整性鉴别和端点鉴别。
  - **UDP服务：** 一种不提供不必要服务的轻量级运输协议，仅提供最小服务。UDP是无连接的，不可靠数据传送，无拥塞控制，无流量控制等。
  - **因特网运输协议所不提供的服务：** 不提供吞吐量、定时和安全性服务
- **2.1.5 应用层协议：** 定义了运行在不同端系统上的应用程序进程如何相互传递报文。定义了以下方面
  - 交换的报文类型，如请求报文和响应报文
  - 各种报文类型的语法，如报文中的字段及其如何描述的
  - 字段的语义，即字段中信息的含义
  - 确定一个进程何时和如何发送报文，以及对报文进行响应的规则
- **2.1.6 本书涉及的网络应用：** Web、文件传输、电子邮件、目录服务（DNS）、流式视频、P2P。
  
## 2.2 Web和HTTP
- **2.2.1 HTTP概况：** HTTP（超文本传输协议）是一个无状态协议，即服务器不保留关于客户的任何信息。HTTP使用TCP作为它的支撑运输协议。Web页面是由对象组成的，对象可以是HTML文件、JPEG图片、Java applet、音频文件等，它们可通过URL地址寻址。
- **2.2.2 非连续连接和持续连接：** 非连续连接指每个请求/响应对都使用一个新的TCP连接，持续连接指一个TCP连接可以传送多个请求/响应对。
  - **采用非连续连接的HTTP：** 每个TCP连接在服务器发送一个对象后关闭，该连接不为其他对象而持续下来，一个连接只传输一个请求报文和响应报文。
    - **RTT（Round-Trip Time 往返时间）：** 一个客户发送请求报文到收到响应报文的时间，三次握手的前两部分耗费的时间占用了一个RTT，第三部分客户端发送HTTP请求报文到收到响应报文的时间占用了一个RTT。总的响应时间就是两个RTT加上服务器传输HTML文件的时间。
  - **采用连续连接的HTTP：** HTTP1.1 服务器发送响应后保持该TCP连接打开，在相同客户与服务器间，后续请求和响应报文可通过相同连接进行传送。HTTP/2 在1.1的基础上允许相同连接中多个请求和回答交错。
- **2.2.3 HTTP报文格式**
  - **HTTP请求报文**
    - **请求行：** 即HTTP请求报文的第一行，有三个字段：方法字段（GET、POST、HEAD、PUT、DELETE）、URL字段、HTTP版本字段
    - **首部行：** 即第一行后续的行，有多个首部行，每个首部行有一个首部名和一个值，如`Host: www.baidu.com`表示对象所在的主机。
    - **实体体：** 请求报文的最后一部分，使用POST方法才使用，包含由请求对象的数据。
  - **HTTP响应报文：** 首行为状态行，中间行为首部行，最后是实体体
    - **状态行：** 有三个字段：HTTP版本字段、状态码字段、状态码和相应状态信息
- **2.2.4 用户与服务器的交互：Cookie：** 允许站点对用用户进行跟踪，是一种服务器发送到用户浏览器并保存在本地的数据块。 
  - HTTP响应报文中的一个Cookie首部行
  - HTTP请求报文中的一个Cookie首部行
  - 在用户端系统中保留一个Cookie文件，由浏览器管理
  - Web站点的后端数据库中存储了用户的信息
- **2.2.5 Web缓存**
  - Web缓存服务器：代理服务器，代表原始服务器存储对象的副本，当缓存服务器收到请求时，它会检查是否有请求的对象的副本，如果有则将副本返回给客户，否则请求原始服务器。
- **2.2.6 条件GET方法：** 保存在缓存服务器的对象副本可能是陈旧的，条件GET方法允许缓存服务器检查对象是否已经被修改。
  - 请求报文使用GET方法
  - 请求报文中包含一个首部行`If-Modified-Since: <date>`，其中`<date>`是对象最后修改的日期

## 2.3 因特网中的电子邮件
  - **组成：** 用户代理、邮件服务器、简单邮件传输协议（SMTP）